# Architectural Design Specification

# 1 引言

## 1.1 编写目的

本说明的目的是对表情包论坛进行概要的功能说明，以便用户及项目开发人员了解产品大致的设计与实现。

以下叙述将结合文字描述、UML等来描述表情包论坛体系结构设计、接口设计，数据设计等方面。

## 1.2 背景

在移动互联网时代，图像文本以网络表情包的方式呈现，依托社会热点实现更新换代。网络表情包通常以简洁、有趣的图片承载复杂的信息和内涵，受众更易识记和理解，它适应了现代社会人们的交流需求得以广泛传播。表情包文化悄然兴起，作为新兴的流行话语体系，网络表情包借助即时通讯软件日渐渗透于大众的日常工作和生活，改变了人们的表达和交流方式，并对社会产生深远影响。

当今聊天软件中，大家对于表情包的使用非常的频繁，表情包作为聊天中必不可少的工具，这是基于网络社交而出现的一种方式，以前我们聊天只是以文字的内容，现在多了表情包，有时候甚至可以用表情包来对话。表情包作为一种新的沟通媒介，能够表达出我们不同的感情，其逐渐成为了网络聊天中不可或缺的一部分，优质的表情包也成为了大家都希望获得的资源，所以我们的项目就是一个可以用来方便的分享、下载并管理表情包的网络平台，方便大家把自己制作的表情包分享给更多的人，也是一个方便的平台来让大家获取更多有趣的表情包

## 1.3 定义

查询：对数据库的一种操作，用于搜索数据信息。

插入：对数据库的一种操作，用于将数据存入数据库中。

更新：对数据库的一种操作，用于更改数据库中的数据信息。

HTTP: 超文本传输协议（Hyper Text Transfer Protocol，HTTP）是一个简单的请求-响应协议，它通常运行在[TCP](https://baike.baidu.com/item/TCP/33012)之上。它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应。

MYSQL：MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一

UML ：统一建模语言(Unified Modeling Language，UML)是一种为面向对象系统的产品进行说明、可视化和编制文档的一种标准语言，是非专利的第三代建模和规约语言。

REST：Representational State Transfer的缩写， 使用URL定位资源，用HTTP动词（GET,POST,DELETE,DETC）描述操作。用来规范客户端如何在HTTP 层与 API 提供方进行数据交互 

## 1.4 参考资料

《GB-T 8567-1988 计算机软件产品开发文件编制指南》

# 2 总体设计

## 2.1 需求规定

用户服务可以提供用户注册(检测用户名是否重复)，用户登录，用户登出，设置用户资料，密保问题，修改密码等服务。

表情包分享服务将提供表情包分类检索用户分享，删除分享，修改分享，点赞分享等功能。

评论服务将提供评论分享，点赞评论，取消点赞评论等功能。

收藏服务将提供收藏分享，取消收藏等功能。

站点系统管理服务将提供管理员查看站点运行状态，维护并管理功能。

后端事务管理将为站点管理员提供帐户管理，统计用户信息、个性化推荐服务。

## 2.2 运行环境

网站前端基于VUE

后端基于go语言的Gin和Gorm框架

数据库基于MySql，配置在服务端运行

客户端访问只需要普通网络浏览器即可访问

## 2.3 基本设计概念和处理流程

### 2.3.1 基本设计概念

实现表情包分享，收藏，评论，个性化推荐功能。

### 2.3.2 处理流程

<img src="https://pig-1307013046.cos.ap-nanjing.myqcloud.com/PigCo/asynccode" alt="img" style="zoom:67%;" />

## 2.4 结构

前台分为个人信息管理模块，表情包分类展示模块，分享管理模块，收藏管理模块，评论管理模块。

后台分为用户管理模块，推荐表情包模块

个人信息管理模块：在用户登录的情况下，用户可以点击“修改个人资料”，进入用户修改个人资料功能页面。

表情包分类展示模块：主页可根据用户输入不同分类展示不同表情包。

分享管理模块：在用户登录的情况下，用户可以在主页点击“分享表情包”进入表情包分享服务。对于发布新的表情包，用户可以选择上传图片，图片从用户本地，上传到网站服务器上；选择表情包的类别。用户可以修改或者删除自己发表的表情包，也可以点赞或者取消点赞其他用户的分享。

收藏管理模块：在用户登录的情况下，用户可以收藏或取消网站中所有的表情包。

评论管理模块：在用户的登录状态下，用户可以评论自己或者其他用户发表的分享，也可以修改或删除评论。用户可以点赞或者取消点赞其他用户评论。

暂时无法在文档外展示此内容

用户管理模块：用户可以注册，登录账号。

推荐表情包模块： 统计用户信息、进行个性化推荐。

<img src="C:\Users\youngbest\Desktop\流程图.jpg" alt="流程图" style="zoom: 33%;" />



## 2.5 功能需求与程序的关系

|              | 前台 | 后台 |
| ------------ | ---- | ---- |
| 用户注册     |      | √    |
| 用户登录     | √    | √    |
| 用户资料修改 | √    | √    |
| 个性化推荐   | √    | √    |
| 表情包搜索   | √    |      |
| 新建分享     | √    | √    |
| 删除分享     | √    | √    |
| 点赞分享     | √    | √    |
| 取消点赞分享 | √    | √    |
| 新建收藏     | √    | √    |
| 取消收藏     | √    | √    |
| 新建评论     | √    | √    |
| 删除评论     | √    | √    |
| 点赞评论     | √    | √    |
| 删除评论     | √    | √    |

## 2.6 人工处理过程

网站设置与用户管理

## 2.7 尚未解决的问题

推荐功能的完善

# 3 接口设计

## 3.1 用户接口

注册页面：显示用户名，用户密码，密保问题，验证手机号，邮箱账号的输入框。对于输入的合法性返回提示信息。

登录页面：显示用户名，密码的输入框。输入的合法性返回提示信息。提供跳转到修改密码的链接

修改密码页面：显示密保问题，提示用用户输入密保问题答案，和两次输入新密码。对于输入的合法性返回提示信息。

用户资料页面：显示用户的资料信息：用户名，用户头像，喜好，

表情包主页：显示表情包及其描述。根据用户的喜好以及当前热点推荐。表情包下方显示点赞，收藏，评论数目。

表情包分类页面：输入框供用户输入表情包类别，显示分类结果。表情包下方显示点赞，收藏，评论数目。

新建分享页面：显示上传图片，输入描述，分类信息的输入框。

收藏页面：显示用户的收藏图片

评论页面：显示用户分享的评论内容以及评论点赞信息

新建评论页面：显示评论输入框以及输入完成的确认建。对于输入的合法性返回提示信息。

## 3.2 外部接口

用户上传图片的端口

用于用户把自己本地的或者其云端网盘上的图片传入网站，每张图片不超过100M

用户对于表情包的评论

用户输入对于表情包的评论，100个字以内，unicode编码

软件接口：windows 操作系统，chrome浏览器

## 3.3 内部接口

初始化模块：系统当用户登入网站后调用，执行完毕后进入消息循环状态。

关闭系统模块：由系统功能模块调用，执行完后返回操作系统。

系统功能模块：接受系统功能区的相应信息，启动浏览、分享、评论、登入、管理模块。

浏览模块：由相应消息驱动，完成对文件模块的直接消息相应功能，可能会调用刷新浏览模块

用户资料模块：由相应消息驱动，完成对用户资料区的直接消息相应功能，可能会调用刷新个人信息管理模块

表情包信息模块：由相应消息驱动，完成对网站中表情包内容的直接消息相应，可能会刷新调用表情包分类展示模块，分享管理模块，收藏管理模块，评论管理模块

统计模块：由相应消息驱动，完成对网站中表情包的统计，可能会刷新调用表情包分类展示模块、推荐模块

密码管理模块：完成对用户和管理员密码的管理

身份验证模块：完成对用户和管理员身份的验证

# 4 运行设计

## 4.1 运行模块组合

系统共有三大主要运行的模块：网上前台显示模块、后台处理统计模块以及用户信息和表情包信息统计模块

部署使用webpack打包，使用nginx代理

HTTP、HTTPS应用层传输协议：前端通过请求接口路径来和后端通信。请求方法包括POST/GET/PUT/DELETE。

## 4.2 运行控制

本系统控制流程：当用户打开网站后启动登入模块。登入系统后，调用系统，由相应的访问方式分别激活其他模块

## 4.3 运行时间

静态数量化需求：

1) 支持同时运行的用户数量: 10000

2) 要处理的信息量和类型: 图片数据传输
3) 响应时间：0.5s
4) 更新处理时间：0.5s
5) 数据的转换和传送时间：1s

动态数量化需求:

高峰期工作负载可以同时运行的用户数量为:10000

灵活性:

1. 同其他软件的接口的变化；
2. 计划的变化或改进：根据用户的需求不断的对软件进行升级和更新

# 5 系统数据结构设计 

## 5.1 逻辑结构设计要点

### 5.1.1 用户表

user_id：用户的id [PK]

username：用户名

user_pic: 用户头像 （存储图片的路径）

password：用户的密码

security_id: 密保问题的id

### 5.1.2 **密保问题库**

security_id：密保问题的id[PK]

question：问题

answer：答案

### 5.1.3 **表情包库**

sticker_id: 表情包的id[PK]

picture: 表情包的内容（存储图片的路径）

category_id: 类别

like_num: 点赞次数

collection_num: 收藏次数

### 5.1.4 用户**收藏表**

collection_id: 收藏条目id[PK]

user_id：用户id

sticker_id: 表情包

### 5.1.5 **类别表**

category_id：类别id[PK]

category_name: 类别的名字

category_description： 类别的描述

### 5.1.6 **分享内容表**

share_id:分享内容的id [PK]

user_id: 用户id

content: 文本内容

sticker_id: 表情包id

like_num: 点赞次数

watch_num: 查看次数

share_time: 分享时间

### 5.1.7 **评论表**

comment_id: 评论id [PK]

share_id: 分享id

user_id : 用户的id

content: 文本

like_num: 点赞次数

### 5.1.8 用户收藏的表情包

user_id : 用户的id

sticker_id: 表情包id

### 5.1.9 用户收藏的评论

user_id : 用户的id

comment_id :  评论的id

## 5.2 物理结构设计要点

### 5.2.1 用户表

| 字段名      | 字段含义     | 类型    | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ----------- | ------------ | ------- | ---- | ------ | -------- | ---- | ---- |
| user_id     | 用户的id     | uint    | 50   |        | 否       | 是   | 自增 |
| username    | 用户名       | varchar | 50   |        | 否       |      |      |
| user_pic    | 用户头像     | varchar | 200  |        | 否       |      | 唯一 |
| password    | 用户的密码   | varchar | 50   |        | 否       |      |      |
| security_id | 密保问题的id | uint    | 50   |        | 否       |      |      |

### 5.2.2 **密保问题库**

| 字段名      | 字段含义     | 类型    | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ----------- | ------------ | ------- | ---- | ------ | -------- | ---- | ---- |
| security_id | 密保问题的id | uint    | 50   |        | 否       | 是   | 自增 |
| question    | 问题         | varchar | 200  |        | 否       |      |      |
| answer      | 答案         | varchar | 200  |        | 否       |      |      |

### 5.2.3 **表情包库**

| 字段名         | 字段含义     | 类型    | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| -------------- | ------------ | ------- | ---- | ------ | -------- | ---- | ---- |
| sticker_id     | 表情包的id   | uint    | 50   |        | 否       | 是   | 自增 |
| picture        | 表情包的内容 | varchar | 200  |        | 否       |      |      |
| category_id    | 类别         | uint    | 50   |        | 否       |      |      |
| like_num       | 点赞次数     | uint    | 50   | 0      | 否       |      |      |
| collection_num | 收藏次数     | uint    | 50   | 0      | 否       |      |      |

### 5.2.4 用户**收藏表**

| 字段名        | 字段含义   | 类型 | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ------------- | ---------- | ---- | ---- | ------ | -------- | ---- | ---- |
| collection_id | 收藏条目id | uint | 50   |        | 否       | 是   | 自增 |
| user_id       | 用户id     | uint | 50   |        | 否       |      |      |
| sticker_id    | 表情包     | uint | 50   |        | 否       |      |      |

### 5.2.5 **类别表**

| 字段名               | 字段含义   | 类型    | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| -------------------- | ---------- | ------- | ---- | ------ | -------- | ---- | ---- |
| category_id          | 类别id     | uint    | 50   |        | 否       | 是   | 自增 |
| category_name        | 类别的名字 | varchar | 200  |        | 否       |      | 唯一 |
| category_description | 类别的描述 | varchar | 200  |        | 否       |      |      |

### 5.2.6 **分享内容表**

| 字段名     | 字段含义     | 类型    | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ---------- | ------------ | ------- | ---- | ------ | -------- | ---- | ---- |
| share_id   | 分享内容的id | uint    | 50   |        | 否       | 是   | 自增 |
| user_id    | 用户id       | uint    | 50   |        | 否       |      |      |
| content    | 文本内容     | varchar | 200  |        | 否       |      |      |
| sticker_id | 表情包id     | uint    | 50   |        | 否       |      |      |
| like_num   | 点赞次数     | uint    | 50   |        | 否       |      |      |
| watch_num  | 查看次数     | uint    | 50   |        | 否       |      |      |
| share_time | 分享时间     | varchar | 200  |        | 否       |      |      |

### 5.2.7 **评论表**

| 字段名     | 字段含义 | 类型    | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ---------- | -------- | ------- | ---- | ------ | -------- | ---- | ---- |
| comment_id | 评论id   | uint    | 50   |        | 否       | 是   | 自增 |
| share_id   | 分享id   | uint    | 50   |        | 否       |      |      |
| user_id    | 用户的id | uint    | 50   |        | 否       |      |      |
| content    | 文本     | varchar | 200  |        | 否       |      |      |
| like_num   | 点赞次数 | uint    | 50   |        | 否       |      |      |

### 5.2.8 用户收藏的表情包

| 字段名     | 字段含义 | 类型 | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ---------- | -------- | ---- | ---- | ------ | -------- | ---- | ---- |
| user_id    | 用户的id | uint | 50   |        | 否       | 是   | 自增 |
| sticker_id | 表情包id | uint | 50   |        | 否       |      |      |

### 5.2.9 用户收藏的评论

| 字段名     | 字段含义 | 类型 | 长度 | 默认值 | 允许为空 | 主键 | 说明 |
| ---------- | -------- | ---- | ---- | ------ | -------- | ---- | ---- |
| user_id    | 用户的id | uint | 50   |        | 否       | 是   | 自增 |
| comment_id | 评论的id | uint | 50   |        | 否       |      |      |

## 5.3 数据结构与程序的关系

数据结构为关系型数据库，所以在程序中可以用标准的SQL语句与数据结构进行交互。为了保持良好的程序架构，对数据库访问采用DAO设计模式实现，提高维护性和扩张性。

# 6 系统出错处理设计

## 6.1 出错信息

| 错误类型            | 子项             | 错误原因               |
| ------------------- | ---------------- | ---------------------- |
| 数据库错误          | 连接             | 连接超时               |
| 数据库本身          | 数据库代码错误   |                        |
| TCP连接错误         | 连接             | 连接超时错误           |
| 系统部分 自定义错误 | 权限错误         | 管理员权限设置故障     |
| 输入错误            | 用户ID，密码错误 |                        |
| 链接错误            | 内部连接错误     | 文件/图片/网页链接错误 |
| 外部连接错误        | 网页维护         |                        |

## 6.2 补救措施

a.    后备技术，周期性的把系统错误信息记录在电脑硬盘上

b**.**    对于软错误，需要在添加/修改操作中及时对输入数据进行验证，分析错误的类型，并且给出相应的错误提示语句，传送到客户端的浏览器上；                                         

c．对于硬错误，错误类型不较少而且比较明确，所以可以在可能出错的地方中输出相应的出错语句，并将程序重置，最后返回输入阶段；

## 6.3 系统维护设计

数据库方面：定期备份数据库，定期检测数据库的一致性，定期查看操作日志等；

文件方面：可以设定表情包分享时限，定期删除相关文件等，减少存储的数据量